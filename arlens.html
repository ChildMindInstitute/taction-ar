<!doctype html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Taction AR App</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/slick-theme.css">
    <link rel="stylesheet" href="assets/css/style.css?v=201905161239">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,900" rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>

    <script defer src="//cdn.8thwall.com/web/aframe/aframe-animation-component-5.1.2.min.js"></script>
 	<!--   <script src="//cdn.8thwall.com/web/aframe/8frame-0.9.0.min.js"></script> -->
 	<script src="//cdn.8thwall.com/web/aframe/8frame-0.8.2.min.js"></script>
 <!--   <script src="//codeawesome.s3-us-west-2.amazonaws.com/dulce303/assets/xrextras-climatelens.js" ></script> -->
    <script src="./assets/js/xrextras-climatelens.js" ></script>
    <script src="./assets/js/gesture-detector.js"></script>
    <script src="./assets/js/hold-drag.js"></script>
    <script src="./assets/js/pinch-scale.js"></script>
    <script src="./assets/js/two-finger-spin.js"></script>
    <script src="./assets/js/aframe-gif-component.min.js"></script>
    <!-- <script src="./assets/js/photomode.js"></script> -->

    <script src="//cdn.8thwall.com/web/aframe/aframe-extras-4.2.0.min.js"></script>
    <script
    src="//apps.8thwall.com/xrweb?appKey=gcGClZ7V2H4eITDKoOedf6lysRHTJg6JmhxUVEGSk5hu4EdnLkWdecrUfgBVATISaV5xg2"></script>

    <script src="./assets/js/dance.js?v=201905161239"></script>
    
    <link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">

<!-- temp dev styling -->
    <style>
        #bar-wrapper {
          /* display:none; */
          display: block;
          width: 61%;
          left: 20%;
          top: 10%;
          position: relative;
        }

        #bar-wrapper p {
          cursor: default;
          position: relative;
          /* top: calc(50% - 64px); */
          width: 100%;
          text-align: center;
         /* font-family: "Open Sans", Arial, sans-serif; */
          font-size: 18px;
        /*  text-shadow: 2px 2px 2px rgba(0, 0, 0, 0.5);  */
          color: #3a3a3a;
        }

        #bar-wrapper .bar-container {
        /*  position: absolute; */
          /*left: calc(50vw - 4px - 290px / 2);*/
          margin-left: 4%;
          top: calc(50vh - 4px - 10px / 2);
          border-radius: 16px;
          border: 4px solid #3a3a3a;
          height: 16px;
          width: 89%;
          background-color: #eee;
          margin-bottom: 20px;
        }
        #bar-wrapper .bar-container .bar {
          background-color: #3a3a3a;
       /*   margin: -3px 0 0 3px;  */
       margin: -3px 0 3px;
         /* height: 4px; */
         height: 12px;
          width: 4px;
          border-radius: 4px;
        }

        @-webkit-keyframes load {
          0% {
            width: 4px;
          }
          100% {
            width: 284px;
          }
        }
    </style>

        <script>

            //progress bar script
                  //fade in loading progress bar elements
  /*      $( document ).ready(function() {
          $("#bar-wrapper").fadeIn(500);

          $( ".bar" ).delay(500).animate({
            width: "80%",
            }, 28000, "swing",
            function() {
                console.log("progress bar complete");
            });

          });
        });  */

	      // Component that places trees where the ground is clicked
	      AFRAME.registerComponent('tap-place', {
	        init: function() {
	          const ground = document.getElementById('ground')
	          ground.addEventListener('click', event => {
	            // Create new entity for the new object
	            const newElement = document.createElement('a-entity')
	            // The raycaster gives a location of the touch in the scene
	            const touchPoint = event.detail.intersection.point
	            newElement.setAttribute('position', touchPoint)
	            const randomYRotation = Math.random() * 360
	            newElement.setAttribute('rotation', '0 ' + randomYRotation + ' 0')
	            newElement.setAttribute('visible', 'false')
	            newElement.setAttribute('scale', '0.0001 0.0001 0.0001')
	            newElement.setAttribute('gltf-model', '#water-glb')
	            this.el.sceneEl.appendChild(newElement)
	            newElement.addEventListener('model-loaded', () => {
	              // Once the model is loaded, we are ready to show it popping in using an animation
	              newElement.setAttribute('visible', 'true')
	              newElement.setAttribute('animation', {
	                property: 'scale',
	                to: '0.01 0.01 0.01',
	                easing: 'easeOutElastic',
	                dur: 800,
	              })
	            })
	          })
	        }
	      })


      AFRAME.registerComponent('initial-events', {
        init: function() {

        	const scene = this.el.sceneEl;
        	const camera = document.getElementById('camera'); 
        	const thefear = document.getElementById('fear-entity');
        	const assets = document.getElementById('assets');
        	const expload = document.getElementById('explode-graphic');

        	//do stuff when device camera feed becomes visible (don't want asset loading to slow startup)
	        scene.addEventListener('realityready', () => {
	        	//stuff
	        	thefear.components.sound.playSound();

	        	//set init position
		        var angle = camera.getAttribute('rotation');
	            var x = 1 * Math.cos(angle.y * Math.PI / 180);
	            var y = 1 * Math.sin(angle.y * Math.PI / 180);
	            var pos = camera.getAttribute('position');
	            pos.x -= y*15;
	            pos.z -= x*15;
	            pos.y = 0;
	            thefear.setAttribute('position', pos);

	            //set init animation
	            newElement.setAttribute('animation', {
	                property: 'position',
	                to: '1.0 0 1.0',
	                easing: 'easeOutElastic',
	                dur: 800,
	            })
//<img id="explode-img" src="graphics/explode.gif">
	            //load future assets after reality loads
	            const exploadAudioElement = document.createElement('audio');
	            exploadAudioElement.setAttribute('id', 'expload-sound');
	            exploadAudioElement.setAttribute('src', './assets/audio/explosion_backdraft.mp3');
	            assets.appendChild(exploadAudioElement);

	            const exploadGraphicElement = document.createElement('img');
	            exploadGraphicElement.setAttribute('id', 'expload-gif');
	            exploadGraphicElement.setAttribute('src', './assets/gif/explode.gif'); 
	            assets.appendChild(exploadGraphicElement);

	            //add sound & image to expload element
	            expload.setAttribute('sound', 'src', '#expload-sound');
	            expload.setAttribute('sound', 'autoplay', 'false');
	            expload.setAttribute('sound', 'loop', 'true');
	            expload.setAttribute('material', 'shader', 'gif'); 
	            expload.setAttribute('material', 'alphaTest', '0.5');
	            expload.setAttribute('material', 'src', '#expload-gif');

	        })

	        //do stuff after model is loaded
            thefear.addEventListener('model-loaded', () => {
            	thefear.setAttribute('visible', 'true');
            })


            //set init sound
            thefear.setAttribute('sound', 'src', '#fear-sound-1');
            thefear.setAttribute('sound', 'autoplay', 'false');
            thefear.setAttribute('sound', 'loop', 'true');

            //set init model specs
            thefear.setAttribute('visible', 'false');
            thefear.setAttribute('scale', '0.5 0.5 0.5');
            thefear.setAttribute('gltf-model', '#dog-glb');
            thefear.setAttribute('animation-mixer', 'loop', 'repeat');
        }
      })


      AFRAME.registerComponent('pinch-scale-destroy', {
	    schema: {
	      min: {default: 0.3},
	      max: {default: 8}
	    },
	    init: function() {
	      this.initialScale = this.el.object3D.scale.clone()
	      this.scaleFactor = 1
	      this.handleEvent = this.handleEvent.bind(this)
	      this.el.sceneEl.addEventListener('twofingermove', this.handleEvent)
	    },
	    remove: function() {
	      this.el.sceneEl.removeEventListener('twofingermove', this.handleEvent)
	    },
	    handleEvent: function(event) {
	      this.scaleFactor *= 1 + event.detail.spreadChange / event.detail.startSpread
	      this.scaleFactor = Math.min(Math.max(this.scaleFactor, this.data.min), this.data.max)
	  
	      this.el.object3D.scale.x = this.scaleFactor * this.initialScale.x
	      this.el.object3D.scale.y = this.scaleFactor * this.initialScale.y
	      this.el.object3D.scale.z = this.scaleFactor * this.initialScale.z
	    }
	  })
    </script>

</head>
<body class="no_padd">
    <header class="fixed"></header>
    <div class="mob_menu d-block">
       <a href="./index.html" class="mob_logo"><h4>Taction AR App</h4></a>
    </div>
    <!-- Content -->

    <!-- If your app only interacts with image targets and not the world, disabling world tracking can improve speed. -->
    <a-scene
    antialias="true"
    xrweb
    initial-events
    loading-screen
    tap-place
    gesture-detector
    xrextras-almost-there
    xrextras-loading
    xrextras-runtime-error
    photo-mode style="z-index: 0;">
    
      	<a-assets id="assets">
      		<!--  <a-asset-item id="water-glb" src="./assets/models/water-rise-trans5.glb"></a-asset-item> --> 
        <!--	<a-asset-item id="dog-glb" src="./assets/models/low_poly_dog_model.glb"></a-asset-item> -->
            <a-asset-item id="dog-glb" src="./assets/models/bee-big-model.glb"></a-asset-item>
        	<audio id="fear-sound-1" src="./assets/audio/DogGrowling.mp3">

      	</a-assets>

      	<a-camera id="camera" position="0 8 8"></a-camera>

        <a-entity 
        light="type: ambient; intensity: 2;" 
        position="1 4.3 -18"></a-entity>

        <a-entity 
        id="fear-entity" 
        class="cantap" 
        hold-drag 
        two-finger-spin 
        pinch-scale></a-entity>

        <a-entity 
        id="explode-graphic" 
        geometry="primitive:plane;width:12;height:12;" 
        visible="false" 
        look-at="#camera"></a-entity>
      
        <a-entity
        id="ground"
        class="cantap"
        geometry="primitive: box"
        material="color: #ffffff; transparent: true; opacity: 0.0"
        scale="1000 2 1000"
        position="0 -1 0"></a-entity>

    </a-scene>

    <section class="panel">
<div class="inner" style="width: 70%; position: fixed; margin-top: 180px; margin-left: -05px;">
									<ul class="grid-icons three connected">
                                    <li><a href="arlens.html"><span class="icon"><img src="images/dog.svg" alt="" style="width: 70px !important;"/><span class="label">Dogs</span></span></a></li>

                                        <li><a href="arlens2.html"><span class="icon"><img src="images/wasp.svg" alt="" style="width: 70px !important;"/><span class="label">Bees</span></span></a></li>

                                        <li><a href="arlens3.html"><span class="icon"><img src="images/spider.svg" alt="" style="width: 70px !important;"/><span class="label">Spiders</span></span></a></li>

                                        <li><a href="arlens4.html"><span class="icon"><img src="images/lightning-bolt.svg" alt="" style="width: 70px !important;"/><span class="label">Lightning</span></span></a></li>

                                        <li><a href="arlens5.html"><span class="icon"><img src="images/injection.svg" alt="" style="width: 70px !important;"/><span class="label">Injection</span></span></a></li>

                                        <li><a href="arlens6.html"><span class="icon"><img src="images/clown.svg" alt="" style="width: 70px !important;"/><span class="label">Clowns</span></span></a></li>

                                        <li><a href="arlens6.html"><span class="icon"><img src="images/snake.svg" alt="" style="width: 70px !important;"/><span class="label">Snakes</span></span></a></li>

                                        <li><a href="arlens6.html"><span class="icon"><img src="images/jellyfish.svg" alt="" style="width: 70px !important;"/><span class="label">Jellyfish</span></span></a></li>
									</ul>
                                </div>
                                </section>
    <footer class="fixed d-none">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-4 col-12 text-center">
                    <div class="debug-text" style="display: none; color: white; font-size: 8px;">
                        <span id="debug-text-status-1">&nbps;</span>
                        <span id="debug-text-status-2">&nbps;</span>
                        <span id="debug-text-status-3">&nbps;</span>
                    </div>
                    <a href="index.html" class="logo full-width">Taction AR App</a>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="./assets/js/slick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.7.0/vanilla-tilt.min.js"></script>

    <!-- App Interfaces -->
    <script type="text/javascript" src="./assets/js/interfaces.js"></script>

</body>
</html>
